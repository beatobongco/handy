<!DOCTYPE html>
<html>
<head>
  <title></title>
</head>
<body>
  <h1>Handy</h1>
  <canvas id="canvas" />
  <p id="prediction"></p>
<script src="https://cdnjs.cloudflare.com/ajax/libs/numjs/0.16.0/numjs.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/tensorflow/0.11.7/tf.min.js"></script>
<script>
  let model = null
  let testImage = null
  let currResult = null

  function loadImage(src) {
    var img = new Image()
    img.src = src
    img.onload = function() {
      testImage = nj.images.read(img)
      // put image on canvas
      nj.images.save(testImage, document.getElementById('canvas'))

      // first, reshape the image
      // format for shape is [n_images, x_shape, y_shape, n_steps::channels?]
      // src: https://stackoverflow.com/questions/43895750/keras-input-shape-for-conv2d-and-manually-loaded-images
      reshapedImage = testImage.reshape([1, 28, 28, 1])

      // then create a tensor, which our model expects
      _tensor = tf.tensor(reshapedImage.selection.data, [1, 28, 28, 1])

      // gives an array of len num_classes
      let predVector = model.predict(_tensor).dataSync()

      //print for debugging
      console.log(predVector)

      // loop over and check which is 1
      for (var i = 0; i < predVector.length; i++) {
        if (predVector[i]) {
          currResult = i
          document.getElementById('prediction').innerHTML = "Handy sees a " + currResult
        }
      }
    }
  }

  tf.loadModel('tfjs_artifacts/model.json').then(function(res) {
    model = res
    loadImage('data/zero.png')
  })
</script>
</body>
</html>
